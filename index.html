<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Homework 4</title>

  <!-- Load Bulma from CDN (consider saving it to repository instead) -->
    <!-- https://bulma.io/ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">

    <!-- Load Font Awesome 5 (free) icons -->
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>

  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/d3-path.v1.min.js"></script>
  <script src="https://d3js.org/d3-shape.v1.min.js"></script>
  <!-- load the d3.js library -->
  <script src="//d3js.org/d3.v5.min.js"></script>
  <link href="style.css" rel="stylesheet" type="text/css">

</head>

<body>

  <!-- Page header -->
  <!-- https://bulma.io/documentation/layout/hero/ -->
  <section class="hero is-info is-bold">
    <div class="hero-body">
      <div class="container">
        <!-- TODO: Change title -->
        <h1 class="title">Homework 4</h1>
        <!-- TODO: Change subtitle -->
        
      </div>
    </div>
  </section>
  <!-- End page header -->

  <!-- Page navigation -->
  <!-- https://bulma.io/documentation/components/navbar/ -->
  <nav class="navbar is-light" role="navigation" aria-label="main navigation">
    <div class="container">
      <div class="navbar-brand">
        <!-- TODO: Change link to repository homepage if needed -->
        <!-- TODO: Change which navbar-item is-active if needed -->
        <a class="navbar-item is-active" href="index.html">
          <span class="icon"><i class="fas fa-home"></i></span>
          <span>Home</span>
        </a>

        <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="main-menu">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>

      <div id="main-menu" class="navbar-menu has-text-weight-medium">
        <!-- Left navbar items -->
        <div class="navbar-start">
          <a class="navbar-item" href="#data" title="Data">
            <span class="icon"><i class="fas fa-table"></i></span>
            <span>Data</span>
          </a>

          
            <a class="navbar-link" href="#visualizations">
              Visualizations
            </a>
            <div class="navbar-dropdown">
              <a href="nodelink.html" class="navbar-item">
                <span class="icon"><i class="fas fa-chart-line"></i></span>
                <span>Node-Link Diagram</span>
              </a>
              <a href="space.html" class="navbar-item">
                <span class="icon"><i class="fas fa-chart-area"></i></span>
                <span>Space-Filling Diagram</span>
              </a>

        </div>

        <!-- Right navbar items -->
        <div class="navbar-end">
          <!-- TODO: Update as needed -->
          <a class="navbar-item" href="grade.html" title="About">
            <span class="icon"><i class="fas fa-tasks"></i></span>
            <span>Grade</span>
          </a>

          <a class="navbar-item" href="about.html" title="About">
            <span class="icon"><i class="fas fa-info-circle"></i></span>
            <span>About</span>
          </a>
        </div>
      </div>
    </div>
  </nav>
  <!-- End page navigation -->

  <section class="section">
    <div class="container">
      <!-- Begin page content -->
      <div class="content">
        <h1 class="title">
          <!-- TODO: Change page title -->
          Description
        </h1>
        <p class="subtitle">
          <!-- TODO: Change page subtitle -->
          What you can find in this website?
        </p>


        <p>The goal for this homework is to visualize the tree maintenance requests of the city of San Francisco during February 2020 using SF 311 dataset from “<a href="https://data.sfgov.org/City-Infrastructure/311-Cases/vw6y-z8j6">Data SF</a>”.</p>

        <p>In visualization section the map of the city of San Francisco including all tree maintenance requests of the considered timeline has been visualized.</p>

        
        <h2 id="data">About Dataset</h2>


          <p>
          <b>Title:</b> SF 311 Cases <br />
          <b>Source:</b> <a href="https://data.sfgov.org/City-Infrastructure/311-Cases/vw6y-z8j6">https://data.sfgov.org/City-Infrastructure/311-Cases/vw6y-z8j6</a><br />
          <b>Publishing Department:</b> <a href="https://sfgov.org/">Data SF</a><br />
          <b>Rows:</b> 4.14M <br />
          <b>Columns:</b> 20 <br />
          <b>Accessed:</b> <em>April 10, 2020</em><br />
        </p>



        <p>This dataset includes cases generally associated with a place or thing (for example parks, streets, or buildings) and created July 1, 2008 or later. Cases generally logged by a user regarding their own needs (for example, property or business tax questions, parking permit requests) are not included. See the Program Link and detailed attachment below for more information. </p>

        


        <blockquote>
          <p>
            <a href="https://opendatacommons.org/licenses/pddl/1.0/"> Open Data Commons Public Domain Dedication and License</a>.
          </p>
          
        </blockquote>

        <p>Overall, original dataset has 20 columns, below you can find important columns that some of them were used on this website's visualizations and their detailed description:</p>

        <ol>

          <li><strong>CaseID:</strong> The unique ID of the service request created.</li>

          <li><strong>Opened:</strong> The date and time when the service request was made</li>

          <li><strong>Responsible Agency:</strong> The agency responsible for fulfilling or otherwise addressing the service request.</li>

          <li><strong>Category:</strong> The human readable name of the service request type.</li>

          <li><strong>Neighborhood:</strong> San Francisco Neighborhood as defined in 'SF Find Neighborhoods'.  </li>

          <li><strong>Police District:</strong> San Francisco Police District as defined in 'Current Police Districts'. </li>


        </ol>

        
        <h3 id="wrangling">Wrangling</h3>

        <p>Data has been filtered using DataSF website tools. Dataset is narrowed down to 427 rows using columns: Category, Opened and Status .</p>

        

        <h2 id="visualizations">Visualizations</h2>

      <h6>D3 Implementation:</h6>
      
      <h3>Tree Maintenance Requests, February 2020</h3>
    
    <!--
  hard-code the svg and various g layers so that even if the streets are loaded
  and drawn last, they will still show up behind the symbols
-->

<figure>
  <svg width="960" height="600" id="vis">
    <g id="basemap"></g>

    <!-- turn off pointer events for certain groups -->
    <g id="streets" pointer-events="none"></g>
    <g id="outline" pointer-events="none"></g>

    <g id="trees"></g>
    <g id="tooltip" pointer-events="none"></g>
    <g id="details" pointer-events="none"></g>
  </svg>

  <figcaption>
    Source: <a href="https://data.sfgov.org/City-Infrastructure/311-Cases/vw6y-z8j6">SF 311 Cases</a> (<a href="https://data.sfgov.org/Geographic-Locations-and-Boundaries/Analysis-Neighborhoods/p5b7-5n3h">Neighborhoods</a>, <a href="https://data.sfgov.org/Geographic-Locations-and-Boundaries/Streets-Active-and-Retired/3psu-pn9h">Streets</a>)
  </figcaption>
</figure>
      
      <br>
      <br>

      <p>
        This map shows the number of tree maintenance requests during February 2020 for the city of San Francisco. Also some interactivities including brushing and a table with all necessary information of each request have been implemented.
      </p>

      
    
<h2 id="grade">Grade</h2>

        <!-- TODO: Remove custom style if no longer needed -->
        <style>
          table.grades tbody tr td:nth-child(1),
          table.grades tbody tr td:nth-child(2) {
            text-align: center;
          }
        </style>

        <!-- TODO: Change or remove table -->
        <!-- https://bulma.io/documentation/elements/table/ -->
        <table class="table is-hoverable is-bordered grades">
          <thead>
            <tr>
              <th>Letter</th>
              <th>Done?</th>
              <th>Description</th>
            </tr>
          </thead>

          <tbody>
         
                
                <tr>
                  <td>A</td>
                  <td><i class="has-text-success fas fa-check-circle"></i></td>
                  <td>
                    <p>This grade requirements has been successfully completed as:</p>
                    <ul>
                      <li>Brushing interactivity plus detail-on-demand .</li>
                      
                    </ul>
                  </td>
                </tr>
      
          </tbody>

        </table>

  

        <h2 id="about">About Me</h2>

        <!-- Profile box -->
        <!-- https://bulma.io/documentation/layout/media-object/ -->
        <article class="media">
          <!-- TODO: Replace with profile photo -->
          <figure class="media-left">
            <p class="image is-128x128" ><img class="is-rounded" src="parisa.jpg"></p>
          </figure>

          <div class="media-content">
            <div class="content">
              <!-- TODO: Replace with contact information -->
              <p>
                <strong>Parisa Hemmati</strong><br/>
                CS Major, <a href="https://www.usfca.edu/">University of San Francisco</a><br/>
                <em>Expected Graduation: May 2022</em><br/>
                <i class="fas fa-envelope"></i> <a href="mailto:username@dons.usfca.edu">Phemmati@dons.usfca.edu</a>
              </p>

              <!-- TODO: Replace with brief biography -->
              <p>
                I am a Computer Science graduate student with experience on Wireless protocol development. Beside programming enthusiast, I am a globetrotter who loves to travel to different part of the world. I have traveled to more than 30 countries up to now and still counting. Reading books and playing piano are my hobbies.
              </p>

              <!-- TODO: Replace or remove tags -->
              <!-- https://bulma.io/documentation/elements/tag/ -->
              <div class="heading">Skills</div>

              <div class="tags">
                <span class="tag">Python</span>
                <span class="tag">C</span>
                <span class="tag">Java</span>
                <span class="tag">JavaScript</span>
                <span class="tag">HTML</span>
                <span class="tag">CSS</span>
                <span class="tag">Tableau</span>
                <span class="tag">Node.js</span>
              </div>
            </div>
          </div>
        </article>
        <!-- End profile box -->

      </div>
      <!-- End page content -->
    </div>
  </section>


  
  </body>




<script src="https://d3js.org/d3.v5.min.js"></script>

<script>
const urls = {
  basemap: "https://data.sfgov.org/resource/xfcw-9evu.geojson",
  streets: "https://data.sfgov.org/resource/3psu-pn9h.geojson?$limit=20000",
  trees: "https://data.sfgov.org/resource/vw6y-z8j6.json"
};

// calculate date range
const end = d3.timeDay.ceil(d3.timeDay.offset(new Date(2020, 01, 29)));
const start = d3.timeDay.floor(d3.timeDay.offset(new Date(2020, 01, 01)));
const format = d3.timeFormat("%Y-%m-%dT%H:%M:%S");
console.log(format(start), format(end));

// add parameters to trees url
urls.trees += "?$where=starts_with(service_name, 'Tree Maintenance')";
urls.trees += " AND requested_datetime between '" + format(start) + "'";
urls.trees += " and '" + format(end) + "'";
urls.trees += " AND status_description = 'Open'";

// output url before encoding
console.log(urls.trees);

// encode special characters
// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI
urls.trees = encodeURI(urls.trees);
console.log(urls.trees);

const svg = d3.select("body").select("svg#vis");

const g = {
  basemap: svg.select("g#basemap"),
  streets: svg.select("g#streets"),
  outline: svg.select("g#outline"),
  trees: svg.select("g#trees"),
  tooltip: svg.select("g#tooltip"),
  details: svg.select("g#details")
};

// setup tooltip (shows neighborhood name)
const tip = g.tooltip.append("text").attr("id", "tooltip");
tip.attr("text-anchor", "end");
tip.attr("dx", -5);
tip.attr("dy", -5);
tip.style("visibility", "hidden");

// add details widget
// https://bl.ocks.org/mbostock/1424037
const details = g.details.append("foreignObject")
  .attr("id", "details")
  .attr("width", 960)
  .attr("height", 600)
  .attr("x", 0)
  .attr("y", 0);

const body = details.append("xhtml:body")
  .style("text-align", "left")
  .style("background", "none")
  .html("<p>N/A</p>");

details.style("visibility", "hidden");

// setup projection
// https://github.com/d3/d3-geo#geoConicEqualArea
const projection = d3.geoConicEqualArea();
projection.parallels([37.692514, 37.840699]);
projection.rotate([122, 0]);

// setup path generator (note it is a GEO path, not a normal path)
const path = d3.geoPath().projection(projection);

d3.json(urls.basemap).then(function(json) {
  // makes sure to adjust projection to fit all of our regions
  projection.fitSize([960, 600], json);

  // draw the land and neighborhood outlines
  drawBasemap(json);

  // now that projection has been set trigger loading the other files
  // note that the actual order these files are loaded may differ
  d3.json(urls.streets).then(drawStreets);
  d3.json(urls.trees).then(drawTrees);
});

function drawBasemap(json) {
  console.log("basemap", json);

  const basemap = g.basemap.selectAll("path.land")
    .data(json.features)
    .enter()
    .append("path")
    .attr("d", path)
    .attr("class", "land");

  const outline = g.outline.selectAll("path.neighborhood")
      .data(json.features)
      .enter()
      .append("path")
      .attr("d", path)
      .attr("class", "neighborhood")
      .each(function(d) {
        // save selection in data for interactivity
        // saves search time finding the right outline later
        d.properties.outline = this;
      });

  // add highlight
  basemap.on("mouseover.highlight", function(d) {
    d3.select(d.properties.outline).raise();
    d3.select(d.properties.outline).classed("active", true);
  })
  .on("mouseout.highlight", function(d) {
    d3.select(d.properties.outline).classed("active", false);
  });

  // add tooltip
  basemap.on("mouseover.tooltip", function(d) {
    tip.text(d.properties.nhood);
    tip.style("visibility", "visible");
  })
  .on("mousemove.tooltip", function(d) {
    const coords = d3.mouse(g.basemap.node());
    tip.attr("x", coords[0]);
    tip.attr("y", coords[1]);
  })
  .on("mouseout.tooltip", function(d) {
    tip.style("visibility", "hidden");
  });
}

function drawStreets(json) {
  console.log("streets", json);

  // only show active streets
  const streets = json.features.filter(function(d) {
    return d.properties.active;
  });

  console.log("removed", json.features.length - streets.length, "inactive streets");

  g.streets.selectAll("path.street")
    .data(streets)
    .enter()
    .append("path")
    .attr("d", path)
    .attr("class", "street");
}

function drawTrees(json) {
  console.log("trees", json);

  // loop through and add projected (x, y) coordinates
  // (just makes our d3 code a bit more simple later)
  json.forEach(function(d) {
    const latitude = parseFloat(d.lat);
    const longitude = parseFloat(d.long);
    const pixels = projection([longitude, latitude]);

    d.x = pixels[0];
    d.y = pixels[1];
  });

  const symbols = g.trees.selectAll("circle")
    .data(json)
    .enter()
    .append("circle")
    .attr("cx", d => d.x)
    .attr("cy", d => d.y)
    .attr("r", 3)
    .attr("class", "symbol");
  
  

  symbols.on("mouseover", function(d) {
    d3.selectAll('circle')
          .style('opacity', 0.1);
    d3.select(this).raise();
    d3.select(this).classed("active", true);
    d3.select(this)
        .style('opacity', 1)
        .style("stroke-width", 1)
        .style("cursor", "pointer");
  

    // use template literal for the detail table
    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals
    const html = `
      <table border="1" cellspacing="0" cellpadding="2">
      <tbody>
        <tr>
          <th>CaseID:</th>
          <td>${d.service_request_id}</td>
        </tr>
        <tr>
          <th>Opened:</th>
          <td>${new Date(d.requested_datetime).toDateString()}</td>
        </tr>
        <tr>
          <th>Responsible Agency:</th>
          <td>${d.agency_responsible}</td>
        </tr>
        <tr>
          <th>Neighborhood:</th>
          <td>${d.neighborhoods_sffind_boundaries}</td>
        </tr>
        <tr>
          <th>Category:</th>
          <td>${d.service_name}</td>
        </tr>
        <tr>
          <th>Police District:</th>
          <td>${d.police_district}</td>
        </tr>
      </tbody>
      </table>
    `;

    body.html(html);
    details.style("visibility", "visible")
    .style("width", "300px");
  });

  symbols.on("mouseout", function(d) {
    d3.selectAll("circle")
          .style('opacity', 1);
    d3.select(this).classed("active", false);
    d3.select(this)
        .style("stroke-width", 1)
        .style("cursor", "none");
    details.style("visibility", "hidden");
  });
  
 
}

function translate(x, y) {
  return "translate(" + String(x) + "," + String(y) + ")";
}
</script>


  <!-- Page footer -->
  <!-- https://bulma.io/documentation/layout/footer/ -->
  <footer class="footer">
    <div class="content has-text-centered is-size-7">
      <p>
        <a href="#top">
          <span class="fas fa-arrow-up"></span>
          <span class="has-text-weight-medium">Back to Top</span>
        </a>
      </p>

      <p>
        <!-- TODO: Change to link to your Github repository -->
        <a href="https://github.com/usf-cs360-spring2020/template-bulma" class="button is-small" style="padding-left: 1em; padding-right: 1em;">
          <i class="fab fa-github-alt"></i>&nbsp;<strong>Github</strong>
        </a>

        <a href="https://fontawesome.com/" class="button is-small" style="padding-left: 1em; padding-right: 1em;">
          <i class="fab fa-font-awesome"></i>&nbsp;<strong>FontAwesome</strong>
        </a>

        <a href="https://bulma.io" class="button is-small">
          <img src="https://bulma.io/images/made-with-bulma--semiblack.png" alt="Made with Bulma" width="128" height="24">
        </a>
      </p>
    </div>
  </footer>
  <!-- End page footer -->

  <!-- Mobile menu responsiveness -->
  <!-- https://bulma.io/documentation/components/navbar/ -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

    if ($navbarBurgers.length > 0) {
      $navbarBurgers.forEach( el => {
        el.addEventListener('click', () => {
          const target = el.dataset.target;
          const $target = document.getElementById(target);
          el.classList.toggle('is-active');
          $target.classList.toggle('is-active');
        });
      });
    }
  });
  </script>
  <!-- End mobile menu responsiveness -->
</body>
